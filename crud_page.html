<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Data</title>
  <style>
    
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #eef2f7;
      display: flex;
      justify-content: center;
      padding: 40px 15px;
      min-height: 100vh;
      color: #2c3e50;
    }

    
    .container {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      max-width: 900px;
      width: 100%;
      padding: 30px 40px 40px 40px;
    }

    h2 {
      margin: 0 0 30px 0;
      font-weight: 700;
      font-size: 2rem;
      text-align: center;
      color: #34495e;
    }

    
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
      align-items: center;
    }

    form input, form select {
      padding: 12px 15px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1.8px solid #bdc3c7;
      transition: all 0.3s ease;
      width: 100%;
    }

    form input:focus, form select:focus {
      border-color: #2980b9;
      outline: none;
      box-shadow: 0 0 8px #2980b9aa;
    }

    form button[type="submit"]{
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      padding: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 140px;
      justify-self: center;
      grid-column: 1 / -1;
    }

    form button[type="submit"]:hover {
      background-color: #1c5980;
    }

  
    table {
      width: 100%;
      border-collapse: collapse;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
      border-radius: 12px;
      overflow: hidden;
    }

    thead tr {
      background: #2980b9;
      color: white;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.9rem;
      letter-spacing: 0.06em;
    }

    th, td {
      padding: 16px 18px;
      text-align: center;
      font-size: 1rem;
      border-bottom: 1px solid #ddd;
    }

    tbody tr:nth-child(even) {
      background-color: #f9fafe;
    }

    tbody tr:hover {
      background-color: #d6e6fb;
      cursor: pointer;
    }

   
    button.edit-btn,
    button.delete-btn {
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin: 0 3px;
    }

    button.edit-btn {
      background-color: #27ae60;
      color: white;
    }
    button.edit-btn:hover {
      background-color: #1e8449;
    }

    button.delete-btn {
      background-color: #e74c3c;
      color: white;
    }
    button.delete-btn:hover {
      background-color: #c0392b;
    }

    
    @media (max-width: 600px) {
      form {
        grid-template-columns: 1fr;
      }
      form button[type="submit"] {
        width: 100%;
        grid-column: 1 / -1;
      }
      th, td {
        padding: 12px 8px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>User Data - CRUD Operation</h2>

    <form id="userForm" autocomplete="off">
      <input type="hidden" id="editIndex" />
      <input type="text" id="name" placeholder="Name" required />

      <input type="email" id="email" placeholder="Email" required />
      <span id="emailError" class="error-msg">Email must end with @gmail.com</span>

      <input type="text" id="age" placeholder="Age" required min="1" />
      <span id="ageError" class="error-msg">Age must be a positive integer</span>

      <select id="gender" required>
        <option value="">Gender</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>

      <input type="tel" id="phone" placeholder="Phone" required pattern="[0-9\s+-]{7,15}" />
      <span id="phoneError" class="error-msg">Phone number must be exactly 10 digits</span>

      <button type="submit">Save User</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>Name</th><th>Email</th><th>Age</th><th>Gender</th><th>Phone</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/users';
    const form = document.getElementById('userForm');
    const tableBody = document.getElementById('userTable');

    const emailInput = document.getElementById('email');
    const ageInput = document.getElementById('age');
    const phoneInput = document.getElementById('phone');

    const emailError = document.getElementById('emailError');
    const ageError = document.getElementById('ageError');
    const phoneError = document.getElementById('phoneError');


    function validateEmail(email) {
      return email.endsWith('@gmail.com');
    }

    function validateAge(age) {
      return Number.isInteger(age) && age > 0;
    }

    function validatePhone(phone) {
      return /^\d{10}$/.test(phone);
    }

   
    emailInput.addEventListener('input', () => {
      if (!validateEmail(emailInput.value.trim())) {
        emailInput.setCustomValidity('Email must end with @gmail.com');
      } else {
        emailInput.setCustomValidity('');
      }
      emailInput.reportValidity();
    });

    emailInput.addEventListener('blur', (e) => {
      if (!validateEmail(emailInput.value.trim())) {
        e.preventDefault();
        emailInput.focus();
      }
    });

    
    ageInput.addEventListener('input', () => {
      const val = Number(ageInput.value);
      if (!validateAge(val)) {
        ageInput.setCustomValidity('Age must be a positive integer');
      } else {
        ageInput.setCustomValidity('');
      }
      ageInput.reportValidity();
    });

    ageInput.addEventListener('blur', (e) => {
      const val = Number(ageInput.value);
      if (!validateAge(val)) {
        e.preventDefault();
        ageInput.focus();
      }
    });

    
    phoneInput.addEventListener('input', () => {
      if (!validatePhone(phoneInput.value.trim())) {
        phoneInput.setCustomValidity('Phone number must be exactly 10 digits');
      } else {
        phoneInput.setCustomValidity('');
      }
      phoneInput.reportValidity();
    });

    phoneInput.addEventListener('blur', (e) => {
      if (!validatePhone(phoneInput.value.trim())) {
        e.preventDefault();
        phoneInput.focus();
      }
    });

    async function loadUsers() {
      const res = await fetch(API_URL);
      const users = await res.json();
      tableBody.innerHTML = '';
      users.forEach((user, index) => {
        tableBody.innerHTML += `
          <tr>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${user.age}</td>
            <td>${user.gender}</td>
            <td>${user.phone}</td>
            <td>
              <button class="edit-btn" onclick="editUser(${index})" title="Edit User">Edit</button>
              <button class="delete-btn" onclick="deleteUser(${index})" title="Delete User">Delete</button>
            </td>
          </tr>
        `;
      });
    }

    form.addEventListener('submit', async e => {
      e.preventDefault();

      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const age = Number(form.age.value);
      const gender = form.gender.value;
      const phone = form.phone.value.trim();

      
      if (!validateEmail(email)) {
        alert('Email must end with @gmail.com');
        form.email.focus();
        return;
      }
      if (!validateAge(age)) {
        alert('Age must be a positive integer');
        form.age.focus();
        return;
      }
      if (!validatePhone(phone)) {
        alert('Phone number must be exactly 10 digits');
        form.phone.focus();
        return;
      }

      const user = { name, email, age, gender, phone };
      const editIndex = form.editIndex.value;

      if (editIndex === '') {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(user),
        });
      } else {
        await fetch(`${API_URL}/${editIndex}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(user),
        });
        form.editIndex.value = '';
      }
      form.reset();
      loadUsers();
    });

    async function editUser(index) {
      const res = await fetch(API_URL);
      const users = await res.json();
      const user = users[index];
      form.name.value = user.name;
      form.email.value = user.email;
      form.age.value = user.age;
      form.gender.value = user.gender;
      form.phone.value = user.phone;
      form.editIndex.value = index;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function deleteUser(index) {
      if (!confirm('Are you sure you want to delete this user?')) return;
      await fetch(`${API_URL}/${index}`, { method: 'DELETE' });
      loadUsers();
    }

    loadUsers();
  </script>
</body>
</html>


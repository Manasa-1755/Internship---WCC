<!DOCTYPE html>
<html>
<head>
    <title>OpenRouter Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #879cba;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        #chatbox {
            width: 100%;
            max-width: 700px;
            background: #ebe7e7;
            border: 3px solid #5a0f0f;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h2 {
            margin-top: 0;
            text-align: center;
            color: #222;
        }
        #model-info {
            text-align: center;
            font-size: 14px;
            margin-bottom: 10px;
            color: rgb(4, 4, 4);
        }
        #messages {
            height: 400px;
            overflow-y: auto;
            border: 3px solid #5a0f0f;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            background: #879cba;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Chat bubbles */
        .bubble {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 15px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        /* User messages align right */
        .user {
            background: #f0f2f5;
            color: #5a0f0f;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        /* Model messages align left */
        .model {
            background: #f8f2f2;
            color: #951010;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        /* Typing indicator */
        .thinking {
            background: #ececec;
            color: #222;
            border-radius: 15px;
            padding: 8px 12px;
            align-self: flex-start;
            display: flex;
            gap: 4px;
        }

        #controls {
            display: flex;
            gap: 10px;
        }
        #userInput {
            flex: 1;
            padding: 10px;
            font-size: 14px;
        }
        button, select {
            padding: 10px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px;
            border: none;
        }
        #sendBtn {
            background: #0078ff;
            color: white;
        }

        /* Dots animation */
        .dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            margin: 0 2px;
            background: #555;
            border-radius: 50%;
            animation: blink 1.4s infinite both;
        }
        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0% { opacity: 0.2; }
            20% { opacity: 1; }
            100% { opacity: 0.2; }
        }

        /* Style for markdown inside model bubble */
        .model h3 {
            margin: 6px 0;
            font-size: 16px;
            font-weight: bold;
        }
        .model code {
            background: #ddd;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }
        .model pre {
            background: #333;
            color: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
        }
        
        /* Add black border to dropdown */
select {
    border: 2px solid #000;
    border-radius: 8px;
}

/* Add black border to user input */
#userInput {
    border: 2px solid #000;
    border-radius: 8px;
}

/* Add black border to user messages */
.user {
    border: 2px solid #000;
}

/* Add black border to model messages */
.model {
    border: 2px solid #000;
}

/* Add black border to typing indicator */
.thinking {
    border: 2px solid #000;
}


    </style>
</head>
<body>
    <div id="chatbox">
        <h2>Chat with OpenRouter API Key</h2>

        <div style="text-align:center; margin-bottom:10px;">
            <label for="model">Choose Model: </label>
            <select id="model" onchange="updateModelInfo()">
                <option value="openai/gpt-4o-mini">GPT-4o Mini</option>
                <option value="openai/gpt-4o">GPT-4o</option>
                <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                <option value="mistralai/mistral-large">Mistral Large</option>
            </select>
        </div>

        <div id="model-info">Now chatting with: GPT-4o Mini</div>

        <div id="messages">
            <div class="model">{{ greeting }}</div>
        </div>


        <div id="controls">
            <input type="text" id="userInput" placeholder="Type a message..." />
            <button id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        function updateModelInfo() {
            let model = document.getElementById("model");
            let selectedText = model.options[model.selectedIndex].text;
            document.getElementById("model-info").innerText = "Now chatting with: " + selectedText;
        }

        async function sendMessage() {
            let input = document.getElementById("userInput");
            let message = input.value.trim();
            let model = document.getElementById("model").value;
            if (!message) return;

            let messagesDiv = document.getElementById("messages");

            // Add user bubble
            messagesDiv.innerHTML += `<div class="bubble user">${message}</div>`;
            input.value = "";
            // Scroll into view of the newly added element
            let lastBubble = messagesDiv.lastElementChild;
            if (lastBubble) {
                lastBubble.scrollIntoView({ behavior: "smooth", block: "start" });
            }


            // Show typing indicator
            let thinkingId = "thinking-" + Date.now();
            messagesDiv.innerHTML += `
                <div id="${thinkingId}" class="thinking">
                    <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                </div>
            `;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Send to backend
            let response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message, model })
            });

            let data = await response.json();

            // Remove typing animation
            document.getElementById(thinkingId).remove();

            // Render markdown reply
            let formattedReply = marked.parse(data.reply);
            messagesDiv.innerHTML += `<div class="bubble model">${formattedReply}</div>`;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Enable Enter key to send
        document.getElementById("userInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault(); 
                sendMessage();
            }
        });
    </script>
</body>
</html>
